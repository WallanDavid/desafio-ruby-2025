<div class="d-flex justify-content-between align-items-center mb-4">
  <h2>
    <i class="bi bi-people"></i> Customers
  </h2>
  <div class="text-muted">
    <%= pluralize(@customers.total_count, 'customer') %>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <%= form_with url: customers_path, method: :get, local: true, class: "row g-3 mb-4" do |form| %>
      <div class="col-md-4">
        <%= form.text_field :email, class: "form-control", placeholder: "Filter by email...", value: params[:email] %>
      </div>
      <div class="col-md-4">
        <%= form.text_field :phone, class: "form-control", placeholder: "Filter by phone...", value: params[:phone] %>
      </div>
      <div class="col-md-4">
        <%= form.submit "Filter", class: "btn btn-outline-primary" %>
        <%= link_to "Clear", customers_path, class: "btn btn-outline-secondary" %>
      </div>
    <% end %>

    <% if @customers.any? %>
      <div class="table-responsive">
        <table class="table table-hover">
          <thead class="table-light">
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Product Code</th>
              <th>Subject</th>
              <th>Created</th>
            </tr>
          </thead>
          <tbody>
            <% @customers.each do |customer| %>
              <tr>
                <td>
                  <% if customer.name.present? %>
                    <strong><%= customer.name %></strong>
                  <% else %>
                    <span class="text-muted">-</span>
                  <% end %>
                </td>
                <td>
                  <% if customer.email.present? %>
                    <%= customer.email %>
                  <% else %>
                    <span class="text-muted">-</span>
                  <% end %>
                </td>
                <td>
                  <% if customer.phone.present? %>
                    <%= customer.phone %>
                  <% else %>
                    <span class="text-muted">-</span>
                  <% end %>
                </td>
                <td>
                  <% if customer.product_code.present? %>
                    <code><%= customer.product_code %></code>
                  <% else %>
                    <span class="text-muted">-</span>
                  <% end %>
                </td>
                <td>
                  <% if customer.subject.present? %>
                    <%= truncate(customer.subject, length: 40) %>
                  <% else %>
                    <span class="text-muted">-</span>
                  <% end %>
                </td>
                <td>
                  <small class="text-muted">
                    <%= customer.created_at.strftime("%m/%d/%Y %H:%M") %>
                  </small>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>

      <div class="d-flex justify-content-between align-items-center mt-3">
        <div>
          <%= page_entries_info @customers %>
        </div>
        <div>
          <%= paginate @customers, theme: 'twitter-bootstrap-4' %>
        </div>
      </div>
    <% else %>
      <div class="text-center py-5">
        <i class="bi bi-inbox display-1 text-muted"></i>
        <h4 class="mt-3 text-muted">No customers found</h4>
        <p class="text-muted">
          <% if params[:email].present? || params[:phone].present? %>
            Try adjusting your search criteria.
          <% else %>
            Upload some .eml files to start extracting customer data.
          <% end %>
        </p>
      </div>
    <% end %>
  </div>
</div>
